---
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: blackbox-exporter-rules
spec:
  groups:
    - name: blackbox-exporter.rules
      rules:
        - alert: ProbeFailed
          expr: probe_success == 0
          for: 5m
          annotations:
            summary: >-
              Probe failed for {{ $labels.instance }}
            description: >-
              The blackbox probe targeting {{ $labels.instance }} has been failing for 5 minutes.
          labels:
            severity: critical

        - alert: ProbeSlowResponse
          expr: probe_duration_seconds > 5
          for: 10m
          annotations:
            summary: >-
              Slow probe response for {{ $labels.instance }}
            description: >-
              The blackbox probe targeting {{ $labels.instance }} is responding slowly (>5s).
          labels:
            severity: warning

        - alert: SSLCertExpiringSoon
          expr: probe_ssl_earliest_cert_expiry - time() < 86400 * 14
          for: 1h
          annotations:
            summary: >-
              SSL certificate expiring soon for {{ $labels.instance }}
            description: >-
              SSL certificate for {{ $labels.instance }} expires in less than 14 days.
          labels:
            severity: warning

        - alert: SSLCertExpired
          expr: probe_ssl_earliest_cert_expiry - time() < 0
          for: 0m
          annotations:
            summary: >-
              SSL certificate expired for {{ $labels.instance }}
            description: >-
              SSL certificate for {{ $labels.instance }} has expired.
          labels:
            severity: critical

