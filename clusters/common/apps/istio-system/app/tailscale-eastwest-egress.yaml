---
# Tailscale egress proxy services for Istio cross-cluster communication.
# These services create standalone egress proxies to reach remote clusters'
# eastwest gateways, avoiding direct Tailscale CGNAT IPs that pods cannot reach.
#
# Note: Using proxy-class instead of proxy-group due to ProxyGroup egress
# not properly setting up port forwarding in operator v1.92.5.
apiVersion: v1
kind: Service
metadata:
  name: robbinsdale-istio-eastwestgateway
  namespace: istio-system
  annotations:
    tailscale.com/tailnet-fqdn: robbinsdale-istio-eastwestgateway.keiretsu.ts.net
    tailscale.com/proxy-class: common
spec:
  externalName: placeholder
  type: ExternalName
  ports:
  - name: status-port
    port: 15021
    protocol: TCP
  - name: tls
    port: 15443
    protocol: TCP
  - name: tls-istiod
    port: 15012
    protocol: TCP
  - name: tls-webhook
    port: 15017
    protocol: TCP
---
apiVersion: v1
kind: Service
metadata:
  name: ottawa-istio-eastwestgateway
  namespace: istio-system
  annotations:
    tailscale.com/tailnet-fqdn: ottawa-istio-eastwestgateway.keiretsu.ts.net
    tailscale.com/proxy-class: common
spec:
  externalName: placeholder
  type: ExternalName
  ports:
  - name: status-port
    port: 15021
    protocol: TCP
  - name: tls
    port: 15443
    protocol: TCP
  - name: tls-istiod
    port: 15012
    protocol: TCP
  - name: tls-webhook
    port: 15017
    protocol: TCP
---
apiVersion: v1
kind: Service
metadata:
  name: stpetersburg-istio-eastwestgateway
  namespace: istio-system
  annotations:
    tailscale.com/tailnet-fqdn: stpetersburg-istio-eastwestgateway.keiretsu.ts.net
    tailscale.com/proxy-class: common
spec:
  externalName: placeholder
  type: ExternalName
  ports:
  - name: status-port
    port: 15021
    protocol: TCP
  - name: tls
    port: 15443
    protocol: TCP
  - name: tls-istiod
    port: 15012
    protocol: TCP
  - name: tls-webhook
    port: 15017
    protocol: TCP
