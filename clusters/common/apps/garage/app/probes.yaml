---
# Garage TCP ports - RPC, API, Admin
kind: Probe
metadata:
  name: app-garage-tcp-local
spec:
  module: tcp_connect
  prober:
    url: blackbox-exporter.monitoring.svc.cluster.local:9115
  targets:
    staticConfig:
      static:
        - garage.garage:3900
        - garage.garage:3903
  metricRelabelings:
    - targetLabel: service
      replacement: garage
    - targetLabel: cluster
      replacement: ottawa
    - targetLabel: target
      replacement: local
      action: replace

---
apiVersion: monitoring.coreos.com/v1
kind: Probe
metadata:
  name: app-garage-tcp-robbinsdale
spec:
  module: tcp_connect
  prober:
    url: blackbox-exporter.monitoring.svc.cluster.local:9115
  targets:
    staticConfig:
      static:
        - robbinsdale-garage.garage:3900
        - robbinsdale-garage.garage:3903
  metricRelabelings:
    - targetLabel: service
      replacement: garage
    - targetLabel: cluster
      replacement: robbinsdale
    - targetLabel: target
      replacement: cross-cluster
      action: replace
---
apiVersion: monitoring.coreos.com/v1
kind: Probe
metadata:
  name: app-garage-tcp-ottawa
spec:
  module: tcp_connect
  prober:
    url: blackbox-exporter.monitoring.svc.cluster.local:9115
  targets:
    staticConfig:
      static:
        - ottawa-garage.garage:3900
        - ottawa-garage.garage:3903
  metricRelabelings:
    - targetLabel: service
      replacement: garage
    - targetLabel: cluster
      replacement: ottawa
    - targetLabel: target
      replacement: cross-cluster
      action: replace
---
apiVersion: monitoring.coreos.com/v1
kind: Probe
metadata:
  name: app-garage-tcp-stpetersburg
spec:
  module: tcp_connect
  prober:
    url: blackbox-exporter.monitoring.svc.cluster.local:9115
  targets:
    staticConfig:
      static:
        - stpetersburg-garage.garage:3900
        - stpetersburg-garage.garage:3903
  metricRelabelings:
    - targetLabel: service
      replacement: garage
    - targetLabel: cluster
      replacement: stpetersburg
    - targetLabel: target
      replacement: cross-cluster
      action: replace
