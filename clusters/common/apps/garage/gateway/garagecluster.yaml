# ---
# Gateway cluster - stateless S3 API proxies
# These pods handle API requests and forward to storage nodes
# Benefits: scale API independently, local metadata for fast routing
apiVersion: garage.rajsingh.info/v1alpha1
kind: GarageCluster
metadata:
  name: garage-gateway
spec:
  replicas: 2
  zone: "${LOCATION}"
  gateway: true

  # Must match storage cluster's replication settings
  replication:
    factor: 3
    zoneRedundancy: "AtLeast(2)"

  connectTo:
    clusterRef:
      name: garage
      namespace: garage

  # Admin API needed for gateway to register with storage cluster
  admin:
    adminTokenSecretRef:
      name: garage-admin-token
      key: admin-token

  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 1000m
      memory: 512Mi
