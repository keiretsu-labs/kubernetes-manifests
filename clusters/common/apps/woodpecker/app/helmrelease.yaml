---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: woodpecker-agent
spec:
  interval: 30m
  chart:
    spec:
      chart: woodpecker
      version: 3.5.1
      sourceRef:
        kind: HelmRepository
        name: woodpecker
        namespace: flux-system
  install:
    remediation:
      retries: 3
  upgrade:
    cleanupOnFail: true
    remediation:
      retries: 3
  values:
    server:
      enabled: false
    agent:
      enabled: true
      replicaCount: 2
      env:
        WOODPECKER_SERVER: "ottawa-woodpecker-grpc.keiretsu.ts.net:9000"
        WOODPECKER_AGENT_SECRET: "${WOODPECKER_AGENT_SECRET}"
        WOODPECKER_BACKEND: "kubernetes"
        WOODPECKER_BACKEND_K8S_NAMESPACE: "woodpecker"
        WOODPECKER_BACKEND_K8S_STORAGE_CLASS: ""
        WOODPECKER_BACKEND_K8S_VOLUME_SIZE: "10G"
