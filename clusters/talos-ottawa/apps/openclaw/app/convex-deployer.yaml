---
apiVersion: batch/v1
kind: Job
metadata:
  name: convex-deployer
  annotations:
    kustomize.toolkit.fluxcd.io/force: enabled
spec:
  backoffLimit: 3
  ttlSecondsAfterFinished: 300
  template:
    spec:
      restartPolicy: OnFailure
      containers:
        - name: deployer
          image: ghcr.io/rajsinghtech/openclaw-convex-deployer:latest
          imagePullPolicy: Always
          env:
            - name: CONVEX_SELF_HOSTED_URL
              value: "http://convex-backend:3210"
            - name: CONVEX_SELF_HOSTED_ADMIN_KEY
              valueFrom:
                secretKeyRef:
                  name: convex-secrets
                  key: admin-key
            - name: JWT_PRIVATE_KEY
              valueFrom:
                secretKeyRef:
                  name: convex-secrets
                  key: jwt-private-key
            - name: JWKS
              valueFrom:
                secretKeyRef:
                  name: convex-secrets
                  key: jwks
