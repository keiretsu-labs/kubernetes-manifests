---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: openclaw
  namespace: openclaw
spec:
  interval: 30m
  chart:
    spec:
      chart: openclaw
      version: 1.3.3
      sourceRef:
        kind: HelmRepository
        name: openclaw
        namespace: flux-system
  install:
    remediation:
      retries: 3
  upgrade:
    cleanupOnFail: true
    remediation:
      retries: 3
  values:
    configMode: merge
    app-template:
      controllers:
        main:
          containers:
            main:
              envFrom:
                - secretRef:
                    name: openclaw-secrets
      configMaps:
        config:
          data:
            openclaw.json: |
              {
                "gateway": {
                  "port": 18789,
                  "mode": "local"
                },
                "browser": {
                  "enabled": true,
                  "cdpUrl": "http://localhost:9222"
                },
                "agents": {
                  "workspace": "/home/node/.openclaw/workspace",
                  "model": "openai/Qwen3-Coder-Next",
                  "timezone": "America/New_York",
                  "timeout": 600,
                  "maxConcurrency": 1
                },
                "session": {
                  "scope": "per-sender",
                  "idleResetMinutes": 60
                },
                "logging": {
                  "level": "info",
                  "consoleStyle": "compact",
                  "redaction": "tools"
                },
                "tools": {
                  "profile": "full",
                  "webSearch": false,
                  "webFetch": true
                }
              }
      persistence:
        data:
          enabled: true
          size: 5Gi
          accessMode: ReadWriteOnce
